import "ecc/babyjubjubParams.code" as context
import "ecc/edwardsOnCurve.code" as onCurve
import "utils/pack/pack256.code" as pack
import "../../circuits/ecAdd.code" as ecAdd
import "../../circuits/ecMul.code" as ecMul
import "../../circuits/constants/G.code" as G
import "../../circuits/constants/H.code" as H
import "../../circuits/rangeProof.code" as rangeProof
import "../../circuits/challenge.code" as challenge
import "../../circuits/transaction.code" as transaction
import "../../circuits/lessThan.code" as lessThan
import "./tx.code" as txData

def testLessThan() -> (field):
  1 == lessThan(10, 20)
  0 == lessThan(20, 10)
  return 1

def testECMul() -> (field):
  field[2] G = G()
  field[2] H = H()
  context = context()
  field[2] rG1 = ecMul(1,G)
  field[2] rG2 = ecMul(2,G)
  field[2] vH1 = ecMul(3,H)
  field[2] vH2 = ecMul(4,H)
  1 == onCurve(rG1, context)
  1 == onCurve(rG2, context)
  1 == onCurve(vH1, context)
  1 == onCurve(vH2, context)
  return 1

def testRangeProof() -> (field):
  // Should pass
  field[2] commitment1 = [\
  17900188049876495034125702978388857976875656050724445573554930117635755526216, \
  1770506462768170141328657139251875677805314676341663359699998809925891075059 \
  ]
  field r1 = 8780529755356302838835647148138951993159754624309233135435419202761373729957
  field v1 = 10000
  // Should fail
  field[2] commitment2 = [\
  4870647013931784995789349278620391659674527799234331409664191866710140813333, \
  15720268085114047304572516513789038640898097556849978657042849384797224253929 \
  ]
  field r2 = 15539733751767519035877175753391852929022939472298817914327280581190631446670
  field v2 = 9007199254740992 // greater than 2^52-1

  1 == rangeProof(r1, v1, commitment1)
  //0 == rangeProof(r2, v2, commitment2)
  return 1

def testChallenge() -> (field):
  field[2] excess = [\
  19725929476198268849980347184655917349594165568759619067459776002865067679162, \
  18176056492709322498161030914492644195271497796665305161040301362898795688395\
  ]
  field[2] sigPoint = [\
  7067966385836520545033351551573859071902429032369198446264325126368434242827, \
  13490357567685217754765402168413589030668364540678213105176822096248033804466 \
  ]
  field fee = 10
  field metadata = 63106042662321134846374981
  field e = challenge(excess[1], sigPoint[1], fee, metadata)
  e == 11711192226294630940159179437332182671897406495562481424104859976886317956392
  return 1

def testTransaction() ->(field):
  txData = txData()
  field[2] kernelExcess = [txData[0], txData[1]]
  field[2] kernelSigScalar = [txData[2], txData[3]]
  field[2] kernelSigPoint = [txData[4], txData[5]]
  field kernelFee = txData[6]
  field kernelMetadata = txData[7]
  field bodySpentTag = txData[8]
  field[2] bodyOutputs1 = [txData[9], txData[10]]
  field[2] bodyOutputs2 = [txData[11], txData[12]]
  field secretInputR = txData[13]
  field secretInputV = txData[14]
  1 == transaction(\
  kernelExcess, kernelFee, kernelMetadata, kernelSigScalar, kernelSigPoint, \
  bodySpentTag, bodyOutputs1, bodyOutputs2, \
  secretInputR, secretInputV \
  )
  return 1

def main() -> (field):
  //1 == testLessThan()
  //1 == testECMul()
  //1 == testRangeProof()
  //1 == testChallenge()
  1 == testTransaction()
  return 1
